{% extends "base.html" %}

{% block title %}Russian Roulette - Setup{% endblock %}

{% block content %}
<div class="card">
    <h1>ğŸ¯ Game Setup</h1>

    <div class="input-group">
        <label for="playerName">Add Players (2-6 required):</label>
        <input type="text" id="playerName" placeholder="Enter player name..." maxlength="20">
        <button onclick="addPlayer()" class="btn btn-success">Add Player</button>
    </div>

    <div class="player-list" id="playerList">
        <h3>Players:</h3>
        <div id="playersContainer">
            <p style="color: #666; font-style: italic;">No players added yet...</p>
        </div>
    </div>

    <div style="margin: 20px 0;">
        <button id="startGameBtn" onclick="startGame()" class="btn btn-secondary" disabled>
            ğŸ® Start Game
        </button>
        <a href="{{ url_for('index') }}" class="btn">
            â† Back to Menu
        </a>
    </div>

    <div class="message-container" id="messageContainer"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
let players = [];

function addPlayer() {
    const nameInput = document.getElementById('playerName');
    const playerName = nameInput.value.trim();

    if (!playerName) {
        showMessage('Please enter a player name', 'error');
        return;
    }

    if (players.includes(playerName)) {
        showMessage('Player name already exists', 'error');
        return;
    }

    if (players.length >= 6) {
        showMessage('Maximum 6 players allowed', 'error');
        return;
    }

    fetch('/add_player', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ name: playerName })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            players = data.players;
            updatePlayersList();
            nameInput.value = '';
            nameInput.focus();
            showMessage(`${playerName} added successfully!`, 'success');
        } else {
            showMessage(data.message, 'error');
        }
    })
    .catch(error => {
        showMessage('Error adding player', 'error');
        console.error('Error:', error);
    });
}

function updatePlayersList() {
    const container = document.getElementById('playersContainer');
    const startBtn = document.getElementById('startGameBtn');

    if (players.length === 0) {
        container.innerHTML = '<p style="color: #666; font-style: italic;">No players added yet...</p>';
        startBtn.disabled = true;
    } else {
        container.innerHTML = players.map((player, index) => `
            <div class="player-item">
                <span>ğŸ‘¤ ${player}</span>
                <button onclick="removePlayer(${index})" style="background: #e74c3c; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer;">
                    âŒ Remove
                </button>
            </div>
        `).join('');

        startBtn.disabled = players.length < 2;
    }

    if (players.length >= 2) {
        startBtn.classList.remove('btn-secondary');
        startBtn.classList.add('btn-success');
    } else {
        startBtn.classList.remove('btn-success');
        startBtn.classList.add('btn-secondary');
    }
}

function removePlayer(index) {
    const playerName = players[index];
    players.splice(index, 1);
    updatePlayersList();
    showMessage(`${playerName} removed`, 'warning');
}

function startGame() {
    if (players.length < 2) {
        showMessage('At least 2 players required to start the game', 'error');
        return;
    }

    fetch('/start_game', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            window.location.href = '/game';
        } else {
            showMessage(data.message, 'error');
        }
    })
    .catch(error => {
        showMessage('Error starting game', 'error');
        console.error('Error:', error);
    });
}

// Allow adding players by pressing Enter
document.getElementById('playerName').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        addPlayer();
    }
});

// Focus on input when page loads
window.addEventListener('load', function() {
    document.getElementById('playerName').focus();
});
</script>
{% endblock %}
